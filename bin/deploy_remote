#!/bin/bash

set -ex

BRANCH=${1:-master}

PATH=/home/ubuntu/local/bin:$PATH

cd /home/isucon/src
git fetch origin
git reset --hard origin/$BRANCH
/home/isucon/local/ruby/bin/bundle check || /home/isucon/local/ruby/bin/bundle install
ln -sf /home/isucon/src/ruby /home/isucon/isubata/webapp
sudo systemctl restart isubata.ruby.service
